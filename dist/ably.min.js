!function t(e,n,r){function s(o,a){if(!n[o]){if(!e[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(i)return i(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return s(n?n:t)},f,f.exports,t,e,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(t,e,n){!function(t,r){"use strict";"function"==typeof define&&define.amd?define([],function(){return r()}):"object"==typeof n?e.exports=r():t.AblySubscriber=r()}(this,function(){"use strict";var t=function(t){this.test=t.test,t.hasOwnProperty("variant")&&(this.variant=t.variant),this.callback=t.callback};return t.prototype.notify=function(t){var e=this;setTimeout(function(){e.callback(t)},1)},t.prototype.matchesTest=function(t){return this.test===t.name},t.prototype.matchesTestAndVariant=function(t,e){return this.hasOwnProperty("variant")?this.test===t&&this.variant===e:this.test===t},t})},{}],2:[function(t,e,n){!function(t,r){"use strict";"function"==typeof define&&define.amd?define([],function(){return r()}):"object"==typeof n?e.exports=r():t.AblyTest=r()}(this,function(){"use strict";var t=function(t){function e(){for(var t,e=0;e<a.subscribers.length;e++)t=a.subscribers[e],t.matchesTestAndVariant(a.name,a.getAssignment())&&t.notify(a);a.subscribers=[]}function n(){s()||(i(),a.sampler(function(t){o(),r(t),e()},a))}function r(t){a.scope.setItem(a.name,t)}function s(){return a.hasOwnProperty("pendingAssignment")}function i(){a.pendingAssignment=!0}function o(){delete a.pendingAssignment}this.name=t.name,this.sampler=t.sampler,this.scope=t.scope,this.variants=t.variants,this.weights=t.weights,this.subscribers=[];var a=this;this.addSubscriber=function(t){this.subscribers.push(t),this.hasAssignment()?e():n()}};return t.prototype.hasAssignment=function(){return this.scope.hasItem(this.name)},t.prototype.getAssignment=function(){return this.scope.getItem(this.name)},t})},{}],3:[function(t,e,n){!function(r,s){"use strict";"function"==typeof define&&define.amd?define(["ably-test","ably-subscriber"],s):"object"==typeof n?e.exports=s(t("./ably-test.js"),t("./ably-subscriber.js")):r.Ably=s(r.AblyTest,r.AblySubscriber)}(this,function(t,e){"use strict";var n=function(){function n(t){for(var e,n=[],r=0;r<p.pendingSubscribers.length;r++)e=p.pendingSubscribers[r],e.matchesTest(t)?t.addSubscriber(e):n.push(e);p.pendingSubscribers=n}function r(t,e){t(e.variants[Math.floor(Math.random()*e.variants.length)])}function s(t,e){var n,s,i=0,o=0;if("undefined"==typeof e.weights)return r(t,e);for(s in e.weights)e.weights.hasOwnProperty(s)&&(i+=e.weights[s]);n=Math.random()*i;for(s in e.weights)if(e.weights.hasOwnProperty(s)){if(n<o+e.weights[s])return void t(s);o+=e.weights[s]}}function i(t){if(!t.hasOwnProperty("sampler"))return p.samplers["default"];if("function"==typeof t.sampler)return t.sampler;if(p.samplers.hasOwnProperty(t.sampler))return p.samplers[t.sampler];throw new Error("sampler '"+t.sampler+"' not found")}function o(t){var e,n;for(e=0;e<t.length;e++)if(n=t[e],"function"!=typeof n.isAvailable||n.isAvailable())return n;throw new Error("no available scope provided")}function a(t){return o([t,p.scopes.pageview])}function u(t){if(!t.hasOwnProperty("scope"))return a(p.scopes["default"]);if("object"==typeof t.scope)return a(t.scope);if(p.scopes.hasOwnProperty(t.scope))return a(p.scopes[t.scope]);throw new Error("scope '"+t.scope+"' not found")}var c={},f={hasItem:function(t){return c.hasOwnProperty(t)},getItem:function(t){return c[t]},setItem:function(t,e){c[t]=e},isAvailable:function(){return!0}},h={hasItem:function(t){return null!==localStorage.getItem(t)},getItem:function(t){return localStorage.getItem(t)},setItem:function(t,e){localStorage.setItem(t,e)},isAvailable:function(){var t="__test_localStorage_capability_ably_18c09e96bdd2cfe6ca47f3285f1b935d";try{var e=window.localStorage;return e.setItem(t,"1"),e.removeItem(t),!0}catch(n){return!1}}};this.tests=[],this.pendingSubscribers=[],this.samplers={local:s,"default":s},this.scopes={pageview:f,device:h,"default":h};var p=this;this.when=function(t,n,r){var s={test:t};"function"==typeof n?r=n:s.variant=n,s.callback=r;var i,o=new e(s);try{i=this.getTest(o.test)}catch(a){return this.pendingSubscribers.push(o),this}return i.addSubscriber(o),this},this.addTest=function(e){var r=new t({name:e.name,variants:e.variants,sampler:i(e),scope:u(e),weights:e.weights});return this.tests.push(r),n(r),this}};return n.prototype.addTests=function(t){for(var e=0;e<t.length;e++)this.addTest(t[e]);return this},n.prototype.getTest=function(t){for(var e=0;e<this.tests.length;e++)if(this.tests[e].name===t)return this.tests[e];throw new Error("test '"+t+"' not found")},n.prototype.getTests=function(){return this.tests},n})},{"./ably-subscriber.js":1,"./ably-test.js":2}],4:[function(t){var e=window.Ably||{};e=t("./ably"),window.Ably=e},{"./ably":3}]},{},[4]);